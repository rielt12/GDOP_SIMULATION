function [y]=GPS(r1,r2,r3,r4,R1,R2,R3,R4)
c=3e8;

y_i=[0;0;0;0];
E1=R1-sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2)+r1(4,1)-y_i(4,1);
E2=R2-sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2)+r2(4,1)-y_i(4,1);
E3=R3-sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2)+r3(4,1)-y_i(4,1);
E4=R4-sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2)+r4(4,1)-y_i(4,1);

rho_1=sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2);
rho_2=sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2);
rho_3=sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2);
rho_4=sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2);


A=[(r1(1,1)-y_i(1,1))/-rho_1,(r1(2,1)-y_i(2,1))/-rho_1,(r1(3,1)-y_i(3,1))/-rho_1,1;
   (r2(1,1)-y_i(1,1))/-rho_2,(r2(2,1)-y_i(2,1))/-rho_2,(r2(3,1)-y_i(3,1))/-rho_2,1;
   (r3(1,1)-y_i(1,1))/-rho_3,(r3(2,1)-y_i(2,1))/-rho_3,(r3(3,1)-y_i(3,1))/-rho_3,1;
   (r4(1,1)-y_i(1,1))/-rho_4,(r4(2,1)-y_i(2,1))/-rho_4,(r4(3,1)-y_i(3,1))/-rho_4,1;];

rho_1=sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2);
y_i1 = y_i;
y_i1(1,1) = y_i(1,1)+0.001;
rho_11 = sqrt((r1(1,1)-y_i1(1,1))^2+(r1(2,1)-y_i1(2,1))^2+(r1(3,1)-y_i1(3,1))^2);
A_numerical(1,1) = (rho_11-rho_1)/0.001;
rho_1=sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2);
y_i2 = y_i;
y_i2(2,1) = y_i(2,1)+0.001;
rho_12=sqrt((r1(1,1)-y_i2(1,1))^2+(r1(2,1)-y_i2(2,1))^2+(r1(3,1)-y_i2(3,1))^2);
A_numerical(1,2) = (rho_12-rho_1)/0.001;
rho_1=sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2);
y_i3 = y_i;
y_i3(3,1) = y_i(3,1)+0.001;
rho_13=sqrt((r1(1,1)-y_i3(1,1))^2+(r1(2,1)-y_i3(2,1))^2+(r1(3,1)-y_i3(3,1))^2);
A_numerical(1,3) = (rho_13-rho_1)/0.001;
A_numerical(1,4) = 1;


rho_2=sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2);
y_i1 = y_i;
y_i1(1,1) = y_i(1,1)+0.001;
rho_21 = sqrt((r2(1,1)-y_i1(1,1))^2+(r2(2,1)-y_i1(2,1))^2+(r2(3,1)-y_i1(3,1))^2);
A_numerical(2,1) = (rho_21-rho_2)/0.001;
rho_2=sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2);
y_i2 = y_i;
y_i2(2,1) = y_i(2,1)+0.001;
rho_22=sqrt((r2(1,1)-y_i2(1,1))^2+(r2(2,1)-y_i2(2,1))^2+(r2(3,1)-y_i2(3,1))^2);
A_numerical(2,2) = (rho_22-rho_2)/0.001;
rho_2=sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2);
y_i3 = y_i;
y_i3(3,1) = y_i(3,1)+0.001;
rho_23=sqrt((r2(1,1)-y_i3(1,1))^2+(r2(2,1)-y_i3(2,1))^2+(r2(3,1)-y_i3(3,1))^2);
A_numerical(2,3) = (rho_23-rho_2)/0.001;
A_numerical(2,4) = 1;


rho_3=sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2);
y_i1 = y_i;
y_i1(1,1) = y_i(1,1)+0.001;
rho_31 = sqrt((r3(1,1)-y_i1(1,1))^2+(r3(2,1)-y_i1(2,1))^2+(r3(3,1)-y_i1(3,1))^2);
A_numerical(3,1) = (rho_31-rho_3)/0.001;
rho_3=sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2);
y_i2 = y_i;
y_i2(2,1) = y_i(2,1)+0.001;
rho_32=sqrt((r3(1,1)-y_i2(1,1))^2+(r3(2,1)-y_i2(2,1))^2+(r3(3,1)-y_i2(3,1))^2);
A_numerical(3,2) = (rho_32-rho_3)/0.001;
rho_3=sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2);
y_i3 = y_i;
y_i3(3,1) = y_i(3,1)+0.001;
rho_33=sqrt((r3(1,1)-y_i3(1,1))^2+(r3(2,1)-y_i3(2,1))^2+(r3(3,1)-y_i3(3,1))^2);
A_numerical(3,3) = (rho_33-rho_3)/0.001;
A_numerical(3,4) = 1;


rho_4=sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2);
y_i1 = y_i;
y_i1(1,1) = y_i(1,1)+0.001;
rho_41 = sqrt((r4(1,1)-y_i1(1,1))^2+(r4(2,1)-y_i1(2,1))^2+(r4(3,1)-y_i1(3,1))^2);
A_numerical(4,1) = (rho_41-rho_4)/0.001;
rho_4=sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2);
y_i2 = y_i;
y_i2(2,1) = y_i(2,1)+0.001;
rho_42=sqrt((r4(1,1)-y_i2(1,1))^2+(r4(2,1)-y_i2(2,1))^2+(r4(3,1)-y_i2(3,1))^2);
A_numerical(4,2) = (rho_42-rho_4)/0.001;
rho_4=sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2);
y_i3 = y_i;
y_i3(3,1) = y_i(3,1)+0.001;
rho_43=sqrt((r4(1,1)-y_i3(1,1))^2+(r4(2,1)-y_i3(2,1))^2+(r4(3,1)-y_i3(3,1))^2);
A_numerical(4,3) = (rho_43-rho_4)/0.001;
A_numerical(4,4) = 1;

E=[E1;E2;E3;E4];

vpa(A)
vpa(A_numerical)
i=0;
while (abs(norm(E))>0.000000001)
  i=i+1;
  delta_y=inv(A_numerical)*E;
  %delta_y = pinv(A'*A)*A'*E
  %delta_y = lsqr((A'*A),A'*E)
  %delta_y = lschol(A'*A,A'*E);

  y_i=y_i+delta_y;

E1=R1-sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2)+r1(4,1)-y_i(4,1);
E2=R2-sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2)+r2(4,1)-y_i(4,1);
E3=R3-sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2)+r3(4,1)-y_i(4,1);
E4=R4-sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2)+r4(4,1)-y_i(4,1);



rho_1=sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2);
rho_2=sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2);
rho_3=sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2);
rho_4=sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2);


A=[(r1(1,1)-y_i(1,1))/-rho_1,(r1(2,1)-y_i(2,1))/-rho_1,(r1(3,1)-y_i(3,1))/-rho_1,1;
   (r2(1,1)-y_i(1,1))/-rho_2,(r2(2,1)-y_i(2,1))/-rho_2,(r2(3,1)-y_i(3,1))/-rho_2,1;
   (r3(1,1)-y_i(1,1))/-rho_3,(r3(2,1)-y_i(2,1))/-rho_3,(r3(3,1)-y_i(3,1))/-rho_3,1;
   (r4(1,1)-y_i(1,1))/-rho_4,(r4(2,1)-y_i(2,1))/-rho_4,(r4(3,1)-y_i(3,1))/-rho_4,1;];


rho_1=sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2);
y_i1 = y_i;
y_i1(1,1) = y_i(1,1)+0.001;
rho_11 = sqrt((r1(1,1)-y_i1(1,1))^2+(r1(2,1)-y_i1(2,1))^2+(r1(3,1)-y_i1(3,1))^2);
A_numerical(1,1) = (rho_11-rho_1)/0.001;
rho_1=sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2);
y_i2 = y_i;
y_i2(2,1) = y_i(2,1)+0.001;
rho_12=sqrt((r1(1,1)-y_i2(1,1))^2+(r1(2,1)-y_i2(2,1))^2+(r1(3,1)-y_i2(3,1))^2);
A_numerical(1,2) = (rho_12-rho_1)/0.001;
rho_1=sqrt((r1(1,1)-y_i(1,1))^2+(r1(2,1)-y_i(2,1))^2+(r1(3,1)-y_i(3,1))^2);
y_i3 = y_i;
y_i3(3,1) = y_i(3,1)+0.001;
rho_13=sqrt((r1(1,1)-y_i3(1,1))^2+(r1(2,1)-y_i3(2,1))^2+(r1(3,1)-y_i3(3,1))^2);
A_numerical(1,3) = (rho_13-rho_1)/0.001;
A_numerical(1,4) = 1;


rho_2=sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2);
y_i1 = y_i;
y_i1(1,1) = y_i(1,1)+0.001;
rho_21 = sqrt((r2(1,1)-y_i1(1,1))^2+(r2(2,1)-y_i1(2,1))^2+(r2(3,1)-y_i1(3,1))^2);
A_numerical(2,1) = (rho_21-rho_2)/0.001;
rho_2=sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2);
y_i2 = y_i;
y_i2(2,1) = y_i(2,1)+0.001;
rho_22=sqrt((r2(1,1)-y_i2(1,1))^2+(r2(2,1)-y_i2(2,1))^2+(r2(3,1)-y_i2(3,1))^2);
A_numerical(2,2) = (rho_22-rho_2)/0.001;
rho_2=sqrt((r2(1,1)-y_i(1,1))^2+(r2(2,1)-y_i(2,1))^2+(r2(3,1)-y_i(3,1))^2);
y_i3 = y_i;
y_i3(3,1) = y_i(3,1)+0.001;
rho_23=sqrt((r2(1,1)-y_i3(1,1))^2+(r2(2,1)-y_i3(2,1))^2+(r2(3,1)-y_i3(3,1))^2);
A_numerical(2,3) = (rho_23-rho_2)/0.001;
A_numerical(2,4) = 1;


rho_3=sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2);
y_i1 = y_i;
y_i1(1,1) = y_i(1,1)+0.001;
rho_31 = sqrt((r3(1,1)-y_i1(1,1))^2+(r3(2,1)-y_i1(2,1))^2+(r3(3,1)-y_i1(3,1))^2);
A_numerical(3,1) = (rho_31-rho_3)/0.001;
rho_3=sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2);
y_i2 = y_i;
y_i2(2,1) = y_i(2,1)+0.001;
rho_32=sqrt((r3(1,1)-y_i2(1,1))^2+(r3(2,1)-y_i2(2,1))^2+(r3(3,1)-y_i2(3,1))^2);
A_numerical(3,2) = (rho_32-rho_3)/0.001;
rho_3=sqrt((r3(1,1)-y_i(1,1))^2+(r3(2,1)-y_i(2,1))^2+(r3(3,1)-y_i(3,1))^2);
y_i3 = y_i;
y_i3(3,1) = y_i(3,1)+0.001;
rho_33=sqrt((r3(1,1)-y_i3(1,1))^2+(r3(2,1)-y_i3(2,1))^2+(r3(3,1)-y_i3(3,1))^2);
A_numerical(3,3) = (rho_33-rho_3)/0.001;
A_numerical(3,4) = 1;


rho_4=sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2);
y_i1 = y_i;
y_i1(1,1) = y_i(1,1)+0.001;
rho_41 = sqrt((r4(1,1)-y_i1(1,1))^2+(r4(2,1)-y_i1(2,1))^2+(r4(3,1)-y_i1(3,1))^2);
A_numerical(4,1) = (rho_41-rho_4)/0.001;
rho_4=sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2);
y_i2 = y_i;
y_i2(2,1) = y_i(2,1)+0.001;
rho_42=sqrt((r4(1,1)-y_i2(1,1))^2+(r4(2,1)-y_i2(2,1))^2+(r4(3,1)-y_i2(3,1))^2);
A_numerical(4,2) = (rho_42-rho_4)/0.001;
rho_4=sqrt((r4(1,1)-y_i(1,1))^2+(r4(2,1)-y_i(2,1))^2+(r4(3,1)-y_i(3,1))^2);
y_i3 = y_i;
y_i3(3,1) = y_i(3,1)+0.001;
rho_43=sqrt((r4(1,1)-y_i3(1,1))^2+(r4(2,1)-y_i3(2,1))^2+(r4(3,1)-y_i3(3,1))^2);
A_numerical(4,3) = (rho_43-rho_4)/0.001;
A_numerical(4,4) = 1;


E=[E1;E2;E3;E4];

norm(E)
end

y=y_i;

end



